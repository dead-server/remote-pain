name: sudo-cry
on:
  workflow_dispatch:

jobs:
  ssh:
    runs-on: ubuntu-latest
    timeout-minutes: 60

    steps:
      - name: Enable SSH and Create User
        run: |
          sudo apt-get update -y
          sudo apt-get install -y openssh-server neofetch
          sudo service ssh start

          if ! id -u "${{ secrets.SSH_USER }}" >/dev/null 2>&1; then
            sudo useradd -m -s /bin/bash "${{ secrets.SSH_USER }}"
          fi

          echo "${{ secrets.SSH_USER }}:${{ secrets.SSH_PASS }}" | sudo chpasswd
          sudo usermod -aG sudo "${{ secrets.SSH_USER }}"

          echo "neofetch" >> /home/${{ secrets.SSH_USER }}/.bashrc

      - name: Install Tailscale
        run: |
          curl -fsSL https://tailscale.com/install.sh | sh
          sudo tailscale up --authkey=${{ secrets.TAILSCALE_AUTH_KEY }} --hostname=sudo-cry-${{ github.run_id }}
          TSIP=$(tailscale ip -4 | head -n1)
          echo "TAILSCALE_IP=$TSIP" >> $GITHUB_ENV

      - name: Ghost Access
        run: |
          echo "ðŸ‘» IP=$TAILSCALE_IP"
          echo "ðŸ‘» USER=${{ secrets.SSH_USER }}"
          echo "ðŸ‘» PASS=${{ secrets.SSH_PASS }}"

      - name: Wait 1 Hour
        run: sleep 3600
